# NyanPass 高性能中转面板 - 完整生产级 PRD（2025 版）

基于 https://github.com/yosebyte/nodepass 完全 API 驱动，不自研任何转发逻辑

**项目代号**：NyanPass  
**目标规模**：单集群 100 万付费用户 · 500 万并发连接 · 99.99% 在线率  
**核心原则**：100% 调用 NodePass Master API 实现所有中转功能，面板只负责管理、统计、订阅生成

## 一、项目概述
- 完全不实现 TCP/UDP/QUIC 转发，所有流量中转由 NodePass 官方二进制完成
- 面板通过 NodePass Master Mode 的 HTTP + WebSocket API 实现节点实例的创建、销毁、重启、实时统计
- 目标：开箱即用、极致性能、百万用户级、零维护成本

## 二、完整功能需求清单

### 用户端功能（MVP 必须实现）
| 编号 | 功能名称                  | 详细要求                                                                 | 优先级 |
|------|---------------------------|------------------------------------------------------------------------|--------|
| U001 | 邮箱注册 + 验证码登录        | 支持找回密码、邮箱验证                                                     | P0     |
| U002 | Telegram OAuth 一键登录     | 绑定后可免密登录                                                            | P0     |
| U003 | 邀请码注册 + 邀请返利        | 每邀请一人获 3-30 天免费时长（可配置）                                       | P0     |
| U004 | 多协议订阅链接生成           | 支持 Clash Meta、Surge、Shadowrocket、V2RayN、Sing-box、NodePass 原生订阅 | P0     |
| U005 | 二维码 + 一键导入            | 自动识别客户端类型                                                            | P0     |
| U006 | 个人中心仪表盘              | 实时显示：今日流量、剩余流量、到期时间、在线设备数                            | P0     |
| U007 | 节点列表与智能筛选           | 按延迟、负载、国家、运营商筛选，支持搜索                                      | P0     |
| U008 | 最近连接记录（审计日志）      | 最近 100 条：IP、节点、协议、上下行、时长                                    | P1     |
| U009 | 客户端自动更新检测           | 内置最新客户端下载地址                                                       | P1     |

### 管理员后台功能（必须）
| 编号 | 功能名称                     | 详细要求                                                                 | 优先级 |
|------|------------------------------|------------------------------------------------------------------------|--------|
| A001 | 用户管理（批量操作）           | 搜索、禁用、充值、重置流量、调整等级、删除                                    | P0     |
| A002 | NodePass Master 节点管理       | 添加/编辑/删除 Master 节点（多区域、多运营商）                                | P0     |
| A003 | NodePass 实例池管理            | 通过 API 批量创建/销毁/重启 server/client 实例，支持按需扩容                 | P0     |
| A004 | 实时节点监控仪表盘             | 显示：在线人数、延迟、负载、带宽、CPU/内存、版本                             | P0     |
| A005 | 全局流量统计与图表             | 按小时/天/周/月，支持导出 CSV                                               | P0     |
| A006 | 公告管理 + 强制弹窗            | 支持 Markdown，前端强制弹出                                                 | P0     |
| A007 | 订阅转换规则集管理             | 内置去广告、分流规则，可自定义上传                                           | P0     |
| A008 | 套餐与等级管理                 | 支持按月/季/年/终身/流量包多种计费方式                                       | P0     |
| A009 | 在线用户实时列表               | 支持搜索用户 ID、节点、IP、实时速度、已用流量                                 | P0     |
| A010 | 异常流量检测与自动封禁          | 单用户 >500Mbps 或异常行为自动禁用                                           | P0     |
| A011 | 系统设置                      | 站点名称、客服 TG、支付开关、注册开关、主题等                                 | P0     |

### 支付与订单系统
| 编号 | 功能名称             | 详细要求                                            | 优先级 |
|------|---------------------|---------------------------------------------------|--------|
| P001 | Stripe 支付（国际卡）  | 支持美元自动续费                                      | P0     |
| P002 | 支付宝 + 微信支付     | 支持当面付、扫码支付（支持 EPAY、爱发电等聚合接口）        | P0     |
| P003 | 手动充值 + 人工审核   | 管理员一键到账                                        | P0     |
| P004 | 订单管理与退款       | 查看、强制完成、退款                                   | P0     |
| P005 | 优惠券系统           | 固定金额、百分比、免费天数，一次性/永久有效               | P1     |

### 高级功能（生产必备）
| 编号 | 功能名称               | 详细要求                                                              | 优先级 |
|------|------------------------|---------------------------------------------------------------------|--------|
| S001 | 多语言支持（中/英/日/俄） | 前端完全 i18n                                                         | P1     |
| S002 | 深色模式 + 主题定制      | 支持自定义 Logo、背景、CSS                                             | P1     |
| S003 | 第三方 API 接口         | 支持用户注册、查余额、查订阅、强制下线（Swagger 文档 + JWT）             | P1     |
| S004 | WebSocket 实时推送      | 流量更新、节点延迟、公告、通知                                           | P0     |
| S005 | 节点自动测速与排序       | 每 5 分钟自动测速，用户端自动按延迟排序                                   | P0     |
| S006 | 故障转移与健康检查       | 节点失联自动下架，自动切换备用线路                                        | P0     |
| S007 | 邮件通知系统            | 注册、支付成功、即将到期（3 天前）、流量用尽自动暂停                        | P1     |
| S008 | 数据库自动备份          | 每日备份到对象存储（S3 兼容）                                            | P1     |
| S009 | Docker 一键部署         | docker-compose + .env 配置                                              | P0     |
| S010 | 零宕机热升级           | 支持蓝绿/滚动升级，不中断用户连接                                         | P0     |

## 三、非功能性需求
| 类别       | 要求                                    | 具体指标                              |
|------------|-----------------------------------------|-------------------------------------|
| 性能       | 订阅生成延迟                              | < 80ms                             |
| 性能       | 面板页面响应时间                          | 99% 请求 < 100ms                   |
| 并发       | 单实例面板支持                            | 5 万同时在线用户，10 万 QPS          |
| 高可用     | 主备数据库切换                            | < 30 秒                            |
| 安全       | 密码存储、JWT、HTTPS、防护                 | bcrypt + 7 天过期 + 全站强制 HTTPS   |
| 监控告警   | 日志 + 指标 + 告警                         | Zap + Prometheus + Grafana + TG 机器人 |
| 兼容性     | NodePass 版本                            | 完全兼容 v1.0+，向下兼容              |

## 四、技术栈要求（推荐）
- 后端：Go 1.24 + Gin + GORM + Zap
- 前端：React 19 + TypeScript 5.6 + Vite + TanStack Query + TailwindCSS
- 数据库：PostgreSQL 17 + TimescaleDB（可选）
- 缓存：Redis Cluster 7.4
- 反向代理：Caddy（自动 HTTPS）
- 部署：Docker Compose + systemd
- 监控：Prometheus + Grafana + NodePass 统计 API

## 五、交付物清单
1. 完整可运行的后端 + 前端源码
2. 数据库迁移脚本（GORM migrate）
3. Docker Compose 一键部署文件
4. NodePass Master 批量部署脚本
5. Grafana 预设仪表盘
6. Swagger API 文档
7. 单元测试 + 集成测试（覆盖率 > 85%）
8. 零宕机升级脚本
9. 详细部署文档 + FAQ
10. 初始管理员账号：`admin@nyanpass.local / NyanPass2025!`

---

以上为完整的生产级 PRD 文档，直接保存为 `NyanPass-PRD-2025.md` 交给 Gemini 即可生成完整项目代码。