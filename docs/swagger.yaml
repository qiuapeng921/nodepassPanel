basePath: /api/v1
definitions:
  handler.ChargeRequest:
    properties:
      amount:
        type: number
    required:
    - amount
    type: object
  handler.MarkPaidRequest:
    properties:
      pay_method:
        type: string
    required:
    - pay_method
    type: object
  handler.SetRequest:
    properties:
      key:
        type: string
      value:
        type: string
    required:
    - key
    type: object
  model.User:
    properties:
      balance:
        description: 资产信息
        type: number
      commission:
        type: number
      created_at:
        type: string
      download:
        type: integer
      email:
        type: string
      expired_at:
        type: string
      group_id:
        type: integer
      id:
        type: integer
      invite_code:
        description: 邀请系统
        type: string
      invited_by:
        type: integer
      is_admin:
        type: boolean
      last_login_at:
        description: 系统信息
        type: string
      last_login_ip:
        type: string
      status:
        description: 状态与权限
        type: integer
      telegram_id:
        description: 第三方绑定
        type: integer
      transfer_enable:
        type: integer
      updated_at:
        type: string
      upload:
        description: '流量控制 (单位: Bytes)'
        type: integer
      uuid:
        description: 订阅唯一标识 (SQLite兼容)
        type: string
    type: object
  response.Response:
    properties:
      code:
        description: 业务码
        type: integer
      data:
        description: 数据
      msg:
        description: 提示信息
        type: string
    type: object
  service.AddNodeRequest:
    properties:
      address:
        type: string
      api_port:
        type: integer
      api_token:
        type: string
      country:
        type: string
      name:
        type: string
      rate:
        minimum: 0
        type: number
      region:
        type: string
    required:
    - address
    - api_port
    - api_token
    - name
    type: object
  service.AdminUpdateUserRequest:
    properties:
      balance:
        type: number
      commission:
        type: number
      download:
        type: integer
      email:
        type: string
      expired_at:
        type: string
      group_id:
        type: integer
      is_admin:
        type: boolean
      password:
        type: string
      status:
        type: integer
      transfer_enable:
        type: integer
      upload:
        type: integer
    type: object
  service.BatchUpdateRequest:
    properties:
      settings:
        items:
          $ref: '#/definitions/service.SettingItem'
        type: array
    required:
    - settings
    type: object
  service.ChangePasswordRequest:
    properties:
      new_password:
        minLength: 6
        type: string
      old_password:
        type: string
    required:
    - new_password
    - old_password
    type: object
  service.CreateAnnouncementRequest:
    properties:
      content:
        type: string
      expired_at:
        type: string
      popup:
        type: boolean
      priority:
        type: integer
      published_at:
        type: string
      status:
        type: integer
      tags:
        type: string
      title:
        type: string
    required:
    - content
    - title
    type: object
  service.CreateOrderRequest:
    properties:
      coupon_id:
        type: integer
      plan_id:
        type: integer
      remark:
        type: string
    required:
    - plan_id
    type: object
  service.CreatePlanRequest:
    properties:
      description:
        type: string
      device_limit:
        description: 设备数限制
        minimum: 0
        type: integer
      duration:
        description: 有效期(天)
        type: integer
      group_id:
        description: 用户组
        type: integer
      hidden:
        description: 是否隐藏
        type: boolean
      name:
        type: string
      price:
        minimum: 0
        type: number
      sort:
        description: 排序权重
        type: integer
      speed_limit:
        description: 速度限制(Mbps)
        minimum: 0
        type: integer
      transfer:
        description: 流量限制(GB)
        minimum: 0
        type: integer
    required:
    - duration
    - name
    type: object
  service.LoginRequest:
    properties:
      email:
        type: string
      password:
        type: string
    required:
    - email
    - password
    type: object
  service.LoginResponse:
    properties:
      token:
        type: string
      user:
        $ref: '#/definitions/model.User'
    type: object
  service.RegisterRequest:
    properties:
      email:
        type: string
      invite_code:
        type: string
      password:
        minLength: 6
        type: string
    required:
    - email
    - password
    type: object
  service.SettingItem:
    properties:
      desc:
        type: string
      group:
        type: string
      key:
        type: string
      type:
        type: string
      value:
        type: string
    required:
    - key
    type: object
  service.UpdateAnnouncementRequest:
    properties:
      content:
        type: string
      expired_at:
        type: string
      popup:
        type: boolean
      priority:
        type: integer
      published_at:
        type: string
      status:
        type: integer
      tags:
        type: string
      title:
        type: string
    type: object
  service.UpdateNodeRequest:
    properties:
      address:
        type: string
      api_port:
        type: integer
      api_token:
        type: string
      carrier:
        type: string
      country:
        type: string
      description:
        type: string
      group_id:
        type: string
      insecure:
        type: boolean
      name:
        type: string
      rate:
        type: number
      region:
        type: string
      sort:
        type: integer
      status:
        type: integer
      type:
        type: string
    type: object
  service.UpdatePlanRequest:
    properties:
      description:
        type: string
      device_limit:
        minimum: 0
        type: integer
      duration:
        type: integer
      group_id:
        type: integer
      hidden:
        type: boolean
      name:
        type: string
      price:
        minimum: 0
        type: number
      sort:
        type: integer
      speed_limit:
        minimum: 0
        type: integer
      transfer:
        minimum: 0
        type: integer
    type: object
host: localhost:8081
info:
  contact:
    email: support@nyanpass.io
    name: API Support
    url: https://nyanpass.io/support
  description: NyanPass 高性能中转面板 API 文档
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  termsOfService: https://nyanpass.io/terms
  title: NyanPass API
  version: "1.0"
paths:
  /api/v1/admin/announcements:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取所有公告（包含草稿）
      tags:
      - Admin/Announcement
    post:
      consumes:
      - application/json
      parameters:
      - description: 公告信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.CreateAnnouncementRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 创建公告（管理员）
      tags:
      - Admin/Announcement
  /api/v1/admin/announcements/{id}:
    delete:
      parameters:
      - description: 公告ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除公告（管理员）
      tags:
      - Admin/Announcement
    get:
      parameters:
      - description: 公告ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取公告详情（管理员）
      tags:
      - Admin/Announcement
    put:
      consumes:
      - application/json
      parameters:
      - description: 公告ID
        in: path
        name: id
        required: true
        type: integer
      - description: 公告信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.UpdateAnnouncementRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 更新公告（管理员）
      tags:
      - Admin/Announcement
  /api/v1/admin/announcements/{id}/offline:
    post:
      parameters:
      - description: 公告ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 下线公告（管理员）
      tags:
      - Admin/Announcement
  /api/v1/admin/announcements/{id}/publish:
    post:
      parameters:
      - description: 公告ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 发布公告（管理员）
      tags:
      - Admin/Announcement
  /api/v1/admin/nodes:
    post:
      consumes:
      - application/json
      parameters:
      - description: 节点信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.AddNodeRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 添加节点（管理员）
      tags:
      - Admin/Node
  /api/v1/admin/nodes/{id}:
    delete:
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除节点（管理员）
      tags:
      - Admin/Node
    get:
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取节点详情（管理员）
      tags:
      - Admin/Node
    put:
      consumes:
      - application/json
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: integer
      - description: 节点信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.UpdateNodeRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 更新节点（管理员）
      tags:
      - Admin/Node
  /api/v1/admin/nodes/{id}/ping:
    post:
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 测试节点连接（管理员）
      tags:
      - Admin/Node
  /api/v1/admin/nodes/{id}/refresh:
    post:
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 刷新节点状态（管理员）
      tags:
      - Admin/Node
  /api/v1/admin/orders:
    get:
      parameters:
      - description: 页码
        in: query
        name: page
        type: integer
      - description: 每页数量
        in: query
        name: page_size
        type: integer
      - description: 订单状态
        in: query
        name: status
        type: integer
      - description: 用户ID
        in: query
        name: user_id
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取订单列表（管理员）
      tags:
      - Admin/Order
  /api/v1/admin/orders/{id}:
    delete:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除订单（管理员）
      tags:
      - Admin/Order
    get:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取订单详情（管理员）
      tags:
      - Admin/Order
  /api/v1/admin/orders/{id}/paid:
    post:
      consumes:
      - application/json
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      - description: 支付方式
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.MarkPaidRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 标记订单已支付（管理员）
      tags:
      - Admin/Order
  /api/v1/admin/orders/{id}/refund:
    post:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 退款（管理员）
      tags:
      - Admin/Order
  /api/v1/admin/plans:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取所有套餐列表（包含隐藏）
      tags:
      - Admin/Plan
    post:
      consumes:
      - application/json
      parameters:
      - description: 套餐信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.CreatePlanRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 创建新套餐
      tags:
      - Admin/Plan
  /api/v1/admin/plans/{id}:
    delete:
      parameters:
      - description: 套餐ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除套餐
      tags:
      - Admin/Plan
    get:
      parameters:
      - description: 套餐ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取套餐详情
      tags:
      - Admin/Plan
    put:
      consumes:
      - application/json
      parameters:
      - description: 套餐ID
        in: path
        name: id
        required: true
        type: integer
      - description: 套餐信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.UpdatePlanRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 更新套餐
      tags:
      - Admin/Plan
  /api/v1/admin/settings:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取所有设置（管理员）
      tags:
      - Admin/Setting
    post:
      consumes:
      - application/json
      parameters:
      - description: 设置信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.SetRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 设置单个值（管理员）
      tags:
      - Admin/Setting
  /api/v1/admin/settings/{key}:
    delete:
      parameters:
      - description: 设置键名
        in: path
        name: key
        required: true
        type: string
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除设置（管理员）
      tags:
      - Admin/Setting
  /api/v1/admin/settings/batch:
    put:
      consumes:
      - application/json
      parameters:
      - description: 设置列表
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.BatchUpdateRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 批量更新设置（管理员）
      tags:
      - Admin/Setting
  /api/v1/admin/settings/group/{group}:
    get:
      parameters:
      - description: 分组名称
        in: path
        name: group
        required: true
        type: string
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取指定分组的设置（管理员）
      tags:
      - Admin/Setting
  /api/v1/admin/users:
    get:
      parameters:
      - description: 页码
        in: query
        name: page
        type: integer
      - description: 每页数量
        in: query
        name: page_size
        type: integer
      - description: 搜索关键词
        in: query
        name: search
        type: string
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取用户列表（管理员）
      tags:
      - Admin/User
  /api/v1/admin/users/{id}:
    delete:
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除用户（管理员）
      tags:
      - Admin/User
    get:
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取用户详情（管理员）
      tags:
      - Admin/User
    put:
      consumes:
      - application/json
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: 用户信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.AdminUpdateUserRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 更新用户（管理员）
      tags:
      - Admin/User
  /api/v1/admin/users/{id}/ban:
    post:
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 禁用用户（管理员）
      tags:
      - Admin/User
  /api/v1/admin/users/{id}/charge:
    post:
      consumes:
      - application/json
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: 充值金额
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.ChargeRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 用户充值（管理员）
      tags:
      - Admin/User
  /api/v1/admin/users/{id}/reset-traffic:
    post:
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 重置用户流量（管理员）
      tags:
      - Admin/User
  /api/v1/admin/users/{id}/unban:
    post:
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 解禁用户（管理员）
      tags:
      - Admin/User
  /api/v1/announcements:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取已发布公告
      tags:
      - Announcement
  /api/v1/announcements/popup:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取需要弹窗的公告
      tags:
      - Announcement
  /api/v1/nodes:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取节点列表
      tags:
      - Node
  /api/v1/plans:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取可见套餐列表
      tags:
      - Plan
  /api/v1/settings:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取公开设置（站点名称、描述等）
      tags:
      - Setting
  /api/v1/user/orders:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取我的订单列表
      tags:
      - Order
    post:
      consumes:
      - application/json
      parameters:
      - description: 订单信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.CreateOrderRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 创建订单
      tags:
      - Order
  /api/v1/user/orders/{id}:
    get:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取订单详情
      tags:
      - Order
  /api/v1/user/orders/{id}/cancel:
    post:
      parameters:
      - description: 订单ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 取消订单
      tags:
      - Order
  /api/v1/user/password:
    put:
      consumes:
      - application/json
      parameters:
      - description: 密码信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.ChangePasswordRequest'
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 修改密码
      tags:
      - User
  /api/v1/user/profile:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取当前用户信息
      tags:
      - User
  /api/v1/user/subscribe/reset:
    post:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 重置订阅令牌
      tags:
      - User
  /api/v1/user/traffic:
    get:
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取流量统计
      tags:
      - User
  /auth/login:
    post:
      consumes:
      - application/json
      description: 使用邮箱和密码登录，获取 JWT Token
      parameters:
      - description: 登录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/service.LoginResponse'
              type: object
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/response.Response'
        "401":
          description: 登录失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 用户登录
      tags:
      - Auth
  /auth/register:
    post:
      consumes:
      - application/json
      description: 注册新用户账户
      parameters:
      - description: 注册信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/service.RegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 注册失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 用户注册
      tags:
      - Auth
  /client/subscribe/{token}:
    get:
      description: 根据用户 UUID Token 获取订阅链接，支持多种客户端格式
      parameters:
      - description: 用户订阅 Token (UUID)
        in: path
        name: token
        required: true
        type: string
      produces:
      - text/plain
      responses:
        "200":
          description: 订阅配置内容
          schema:
            type: string
        "400":
          description: 缺少 Token
          schema:
            type: string
        "404":
          description: 用户不存在
          schema:
            type: string
      summary: 获取订阅配置
      tags:
      - Subscribe
securityDefinitions:
  BearerAuth:
    description: JWT Token 认证，格式：Bearer {token}
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
